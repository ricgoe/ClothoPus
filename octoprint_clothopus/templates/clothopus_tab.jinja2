<div id="clothopus_tab" class="section">
  <h3>Clothopus Filament Manager</h3>

  <div class="mb-3">
  <button type="button" class="btn btn-primary" id="add_filament_btn">
    <i class="fas fa-plus"></i> Add Filament
  </button>
  </div>

  <table class="table table-striped table-bordered" id="clothopus_filament_table">
  <thead class="thead-dark">
    <tr>
    <th>#</th>
    <th>Name</th>
    <th>Kind</th>
    <th>Manufacturer</th>
    <th>Color</th>
    <th>Actions</th>
    </tr>
  </thead>

  <tbody>
    {% set rows = plugin_clothopus_clothopus_rows %}

    {% for row in rows %}
    {% set main = row.data.main if row.data is defined and row.data.main is defined else {} %}
    {% set primary_color = main.primary_color if main.primary_color is defined else {} %}

    <tr>
      <td>{{ loop.index }}</td>

      <td>
      <span class="filament-name">{{ main.material_name}}</span>
      </td>

      <td>
      <span class="filament-kind">{{ main.material_type}}</span>
      </td>

      <td>
      <span class="filament-manufacturer">{{ main.brand_name}}</span>
      </td>

      <td>
      <span class="filament-color">{{ primary_color.hex}}</span>
      </td>

      <td>
      <div class="btn-group" role="group">
        <button type="button" class="btn btn-success btn-sm write-btn">
        <i class="fas fa-pen"></i>
        </button>
        <button type="button" class="btn btn-secondary btn-sm read-btn">
        <i class="fas fa-book"></i>
        </button>
        <button type="button" class="btn btn-danger btn-sm delete-btn">
        <i class="fas fa-trash"></i>
        </button>
      </div>
      </td>
    </tr>
    {% endfor %}

    {% if rows|length == 0 %}
    <tr>
      <td colspan="6" class="text-muted">No filaments found.</td>
    </tr>
    {% endif %}
  </tbody>
  </table>
  <button class="btn btn-info" data-bind="click: startWizard">
    Setup Scales
  </button>
  <div id="clothopus_status" class="mt-3 text-muted"></div>
  <div id="clothopus_wizard" class="modal fade" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg">
  <div class="modal-content">

    <div class="modal-header">
      <h4 class="modal-title">
        Scale Calibration Wizard
      </h4>
    </div>

    <div class="modal-body" data-bind="with: wizard">
      <div data-bind="visible: step() === 1">
        <p>Enter the pin configuration for this scale.</p>

        <div class="form-group">
        <label>DOUT Pin</label>
        <input class="form-control" data-bind="value: pins().dout">
        </div>

        <div class="form-group">
        <label>PD_SCK Pin</label>
        <input class="form-control" data-bind="value: pins().pd_sck">
        </div>
      </div>
      <div data-bind="visible: step() === 2">
        <h5>Place known weight on scale</h5>
        <p>Enter the weight (g) and press "Calibrate".</p>

        <div class="form-group">
        <label>Known Weight (g)</label>
        <input class="form-control" data-bind="value: knownWeight">
        </div>
      </div>
      <div data-bind="visible: step() === 3">
        <h5>Scale Calibrated</h5>
        <pre data-bind="text: JSON.stringify(result(), null, 2)"></pre>
      </div>
    </div>

    <div class="modal-footer" data-bind="with: wizard">
      <button class="btn btn-success"
              data-bind="
                  click: primaryAction,
                  text: primaryText
              ">
      </button>
      <button data-bind="
                  click: secondaryAction,
                  css: {
                      'btn-danger': step() < 3,
                      'btn-success': step() === 3
                  },
                  text: secondaryText
              " class="btn">
      </button>
    </div>
  </div>
  </div>
  </div>
</div>
